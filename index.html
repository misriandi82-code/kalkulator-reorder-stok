<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator Reorder Stok ‚Äî Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --glass: rgba(255,255,255,0.04);
      --accent:#6ee7b7; --accent2:#60a5fa; --danger:#fb7185; --muted:#98a3b8;
      --glass-2: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:linear-gradient(180deg,#071025 0%, #071a2a 60%);color:#e6eef8;min-height:100vh;padding:32px}
    .wrap{max-width:1100px;margin:0 auto}
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
    .logo{width:64px;height:64px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 24px rgba(6,10,20,0.6)}
    .title h1{margin:0;font-size:20px;letter-spacing:-0.3px}
    .title p{margin:2px 0 0;font-size:13px;color:var(--muted)}.grid{display:grid;grid-template-columns:360px 1fr;gap:20px}

.card{background:linear-gradient(180deg,var(--card),#071427);padding:18px;border-radius:14px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid var(--glass)}
label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
input[type=number], input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid var(--glass-2);background:transparent;color:inherit}
button.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#03203b;padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.muted{color:var(--muted);font-size:13px}

.summary{display:flex;gap:12px;margin-top:14px}
.stat{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03)}
.stat h3{margin:0;font-size:14px}
.stat p{margin:6px 0 0;font-size:18px;font-weight:700}

.table-wrap{overflow:auto}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px 12px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:14px}
th{font-size:12px;color:var(--muted);font-weight:600}
tr:hover td{background:rgba(255,255,255,0.01)}
.small{font-size:13px;color:var(--muted)}

.tag{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:700}
.safe{background:rgba(34,197,94,0.12);color:#b7f3cd}
.warn{background:rgba(251,113,133,0.08);color:#ffb6c1}

.controls{display:flex;gap:8px;margin-top:12px}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}

footer{margin-top:18px;color:var(--muted);font-size:13px}

@media(max-width:880px){.grid{grid-template-columns:1fr;}.card{padding:14px}}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">üì¶</div>
      <div class="title">
        <h1>Kalkulator Reorder Stok</h1>
        <p>Ketahanan = (Sisa Stok - Stok Minimal) √∑ Rata‚Äërata Penjualan / hari</p>
      </div>
    </header><div class="grid">
  <div class="card">
    <h3>Tambah / Input Barang</h3>
    <div style="margin-top:10px">
      <label>Nama Barang</label>
      <input id="nama" type="text" placeholder="Contoh: Produk A">
    </div>
    <div style="display:flex;gap:10px;margin-top:10px">
      <div style="flex:1">
        <label>Sisa Stok</label>
        <input id="stok" type="number" min="0" value="100">
      </div>
      <div style="flex:1">
        <label>Stok Minimal</label>
        <input id="min" type="number" min="0" value="30">
      </div>
    </div>
    <div style="display:flex;gap:10px;margin-top:10px">
      <div style="flex:1">
        <label>Rata‚Äërata Penjualan / hari</label>
        <input id="avg" type="number" min="0.01" step="0.01" value="8">
      </div>
      <div style="flex:1">
        <label>&nbsp;</label>
        <button class="btn" id="addBtn">Tambah / Hitung</button>
      </div>
    </div>

    <div class="controls">
      <button class="ghost" id="sample">Isi Contoh</button>
      <button class="ghost" id="clearAll">Bersihkan Semua</button>
      <button class="ghost" id="export">Export CSV</button>
    </div>

    <div class="summary" id="summary">
      <div class="stat">
        <h3>Total Barang</h3>
        <p id="totalCount">0</p>
      </div>
      <div class="stat">
        <h3>Perlu Reorder</h3>
        <p id="needReorder">0</p>
      </div>
      <div class="stat">
        <h3>Rata‚Äërata Ketahanan (hari)</h3>
        <p id="avgDays">-</p>
      </div>
    </div>

  </div>

  <div class="card">
    <h3>Daftar Barang & Hasil Perhitungan</h3>
    <div class="table-wrap">
      <table id="table">
        <thead>
          <tr>
            <th>Barang</th>
            <th>Sisa</th>
            <th>Min</th>
            <th>Avg/day</th>
            <th>Ketahanan (hari)</th>
            <th>Perkiraan Habis</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <footer>Tip: Jika kapasitas <em>Sisa Stok - Stok Minimal</em> ‚â§ 0 maka barang harus direorder segera.</footer>
  </div>
</div>

  </div>  <script>
    // Helper
    const $ = sel => document.querySelector(sel);
    const tbody = document.querySelector('#table tbody');

    function calcDays(stok, min, avg){
      const usable = Number(stok) - Number(min);
      if (isNaN(usable) || isNaN(avg) || avg <= 0) return {days: NaN, usable};
      const days = usable / avg;
      return {days: days, usable};
    }

    function formatDate(days){
      if (!isFinite(days) || days === null || days === undefined) return '-';
      if (days <= 0) return 'Segera';
      const d = new Date();
      const add = Math.floor(days);
      d.setDate(d.getDate() + add);
      return d.toLocaleDateString('id-ID');
    }

    function statusTag(days, usable){
      if (!isFinite(days)) return `<span class="tag warn">Data tidak valid</span>`;
      if (usable <= 0) return `<span class="tag warn">üö® Harus Reorder</span>`;
      if (days <= 3) return `<span class="tag warn">‚ö†Ô∏è Hampir Habis</span>`;
      return `<span class="tag safe">‚úÖ Aman</span>`;
    }

    function renderRow(item, idx){
      const {nama, stok, min, avg, days, usable} = item;
      return `
        <tr data-idx="${idx}">
          <td><div style="font-weight:700">${escapeHtml(nama || '(Tanpa nama)')}</div><div class="small">ID: ${idx+1}</div></td>
          <td>${stok}</td>
          <td>${min}</td>
          <td>${avg}</td>
          <td>${isFinite(days)?Number(days).toFixed(2):'-'}</td>
          <td>${formatDate(days)}</td>
          <td>${statusTag(days, usable)}</td>
          <td style="text-align:right"><button class="ghost" data-action="delete">Hapus</button></td>
        </tr>
      `;
    }

    function escapeHtml(str){
      if (!str) return '';
      return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    function load(){
      const raw = localStorage.getItem('stok.db');
      if (!raw) return [];
      try{ return JSON.parse(raw);}catch(e){return []}
    }
    function save(data){ localStorage.setItem('stok.db', JSON.stringify(data)); }

    function recalcAll(){
      const data = load();
      data.forEach(it=>{
        const r = calcDays(it.stok, it.min, it.avg);
        it.days = r.days;
        it.usable = r.usable;
      });
      save(data);
      tbody.innerHTML = data.map((it,i)=>renderRow(it,i)).join('');

      $('#totalCount').textContent = data.length;
      const need = data.filter(d=>d.usable<=0).length;
      $('#needReorder').textContent = need;
      const validDays = data.filter(d=>isFinite(d.days) && d.days>0).map(d=>d.days);
      const avgDays = validDays.length ? (validDays.reduce((a,b)=>a+b,0)/validDays.length) : null;
      $('#avgDays').textContent = avgDays ? Number(avgDays).toFixed(2) : '-';
    }

    $('#addBtn').addEventListener('click', ()=>{
      const nama = $('#nama').value.trim();
      const stok = Number($('#stok').value);
      const min = Number($('#min').value);
      const avg = Number($('#avg').value);
      if (!isFinite(stok) || !isFinite(min) || !isFinite(avg) || avg <= 0){
        alert('Mohon isi angka valid untuk Sisa Stok, Stok Minimal, dan Rata‚Äërata penjualan (lebih dari 0).');
        return;
      }
      const data = load();
      const r = calcDays(stok,min,avg);
      data.push({nama, stok, min, avg, days: r.days, usable: r.usable});
      save(data);
      recalcAll();

      $('#nama').value = '';
    });

    tbody.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if (!btn) return;
      const tr = e.target.closest('tr');
      const idx = Number(tr.dataset.idx);
      if (btn.dataset.action === 'delete'){
        const data = load(); data.splice(idx,1); save(data); recalcAll();
      }
    });

    $('#clearAll').addEventListener('click', ()=>{
      if (!confirm('Yakin ingin menghapus semua data pada browser ini?')) return;
      localStorage.removeItem('stok.db'); recalcAll();
    });

    $('#sample').addEventListener('click', ()=>{
      const sample = [
        {nama:'Produk A', stok:120, min:30, avg:8},
        {nama:'Produk B', stok:40, min:50, avg:6},
        {nama:'Produk C', stok:200, min:20, avg:12},
      ];
      const data = sample.map(s=>({...s, days: calcDays(s.stok,s.min,s.avg).days, usable: calcDays(s.stok,s.min,s.avg).usable}));
      save(data); recalcAll();
    });

    $('#export').addEventListener('click', ()=>{
      const data = load();
      if (!data.length){ alert('Tidak ada data.'); return; }
      const rows = [['Nama','Sisa Stok','Stok Minimal','Avg/day','Ketahanan (hari)','Perkiraan Habis','Status']];
      data.forEach(d=>{
        const status = d.usable<=0 ? 'Harus Reorder' : (d.days<=3? 'Hampir Habis':'Aman');
        rows.push([d.nama,d.stok,d.min,d.avg, isFinite(d.days)?Number(d.days).toFixed(2):'', formatDate(d.days), status]);
      });
      const csv = rows.map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'reorder-stok.csv'; a.click(); URL.revokeObjectURL(url);
    });

    recalcAll();
  </script></body>
</html>